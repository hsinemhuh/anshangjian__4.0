<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>背诵比对 - 岸上见</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/dark-mode.css">
    <script src="../js/theme-init.js"></script>
    <style>
        .content-box {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            margin: 16px auto;
            overflow: hidden;
            padding: 0;
            max-width: 92%;
            width: 100%;
        }

        .dark-mode .content-box {
            background: #1c1c1e;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
        }

        .box-header {
            padding: 12px 16px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .input-area {
            min-height: 140px;
            max-height: 180px;
            overflow-y: auto;
            padding: 16px;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            background: #fafafa;
        }

        .upload-options {
            display: flex;
            gap: 12px;
            padding: 12px 16px;
            border-top: 1px solid #f0f0f0;
            justify-content: center;
        }

        .upload-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 20px;
            background: #f5f5f5;
            color: #666;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background: #ebebeb;
        }

        .voice-record-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #ff2442;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 2px 8px rgba(255, 36, 66, 0.3);
            transform: translateY(0);
            cursor: pointer;
        }

        .voice-record-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 36, 66, 0.4);
        }

        .voice-record-btn:active {
            transform: scale(0.92) translateY(2px);
            box-shadow: 0 1px 3px rgba(255, 36, 66, 0.2);
        }

        .voice-record-btn::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #ff2442;
            opacity: 0.3;
            transform: scale(0);
            transition: transform 0.3s ease;
        }

        .voice-record-btn.recording::before {
            animation: pulse 1.5s infinite;
        }

        .voice-record-btn.recording {
            background: #e61e3c;
            box-shadow: 0 0 12px rgba(230, 30, 60, 0.5);
            animation: recording-pulse 1s infinite alternate;
        }

        @keyframes recording-pulse {
            0% {
                transform: scale(1);
            }
            100% {
                transform: scale(1.08);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.3;
            }
            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        .result-panel {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px;
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow-y: auto;
            display: none;
            transform: translateY(100%);
        }

        .result-panel.show {
            transform: translateY(0);
        }

        .result-panel-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 16px 0;
            margin: -20px -20px 20px -20px;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            z-index: 10;
        }

        .result-panel-title {
            font-size: 18px;
            font-weight: 600;
            flex-grow: 1;
        }

        .result-panel-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            transition: all 0.3s ease;
        }

        .result-panel-close:hover {
            background: #ebebeb;
            transform: rotate(90deg);
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid #ff2442;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: #ff2442;
            margin: 0 auto 20px;
            position: relative;
            animation: scoreAppear 1s forwards;
            opacity: 0;
            transform: scale(0.8);
        }

        @keyframes scoreAppear {
            0% {
            opacity: 0;
                transform: scale(0.8);
        }
            100% {
            opacity: 1;
                transform: scale(1);
            }
        }

        .score-circle::after {
            content: '';
            position: absolute;
            width: calc(100% + 16px);
            height: calc(100% + 16px);
            border-radius: 50%;
            border: 1px solid rgba(255, 36, 66, 0.2);
            animation: pulseRing 2s infinite;
        }

        @keyframes pulseRing {
            0% {
                transform: scale(0.95);
                opacity: 0.7;
            }
            50% {
                transform: scale(1);
                opacity: 0.3;
            }
            100% {
                transform: scale(0.95);
                opacity: 0.7;
            }
        }

        .progress-bar {
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-bar-fill {
            height: 100%;
            background: #ff2442;
            border-radius: 3px;
            transition: width 1.5s cubic-bezier(0.19, 1, 0.22, 1);
            width: 0 !important;
        }

        .progress-bar-fill.animate {
            width: var(--progress-width) !important;
        }

        .analysis-section {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
            animation: fadeInUp 0.8s forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .analysis-section:nth-child(2) {
            animation-delay: 0.2s;
        }

        .analysis-section:nth-child(3) {
            animation-delay: 0.4s;
        }

        .analysis-section:nth-child(4) {
            animation-delay: 0.6s;
        }

        @keyframes fadeInUp {
            0% {
            opacity: 0;
                transform: translateY(20px);
        }
            100% {
            opacity: 1;
            transform: translateY(0);
        }
        }

        .continue-btn {
            width: 100%;
            background: #ff2442;
            color: white;
            padding: 14px 0;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            margin: 16px 0;
            box-shadow: 0 4px 12px rgba(255, 36, 66, 0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: fadeInUp 0.8s forwards;
            animation-delay: 0.8s;
            opacity: 0;
        }

        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 36, 66, 0.25);
        }

        .continue-btn:active {
            transform: scale(0.98) translateY(0);
            box-shadow: 0 2px 8px rgba(255, 36, 66, 0.2);
        }

        .example-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #f5f5f5;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s ease;
        }

        .example-btn:hover, .example-btn:active {
            background: #ebebeb;
            transform: scale(1.05);
        }

        .recording-timer {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            display: none;
        }

        .recording-timer.show {
            display: block;
        }

        .highlight {
            background: #fff3f5;
            border-radius: 4px;
            padding: 2px 4px;
        }

        .diff-text {
            color: #ff2442;
            text-decoration: line-through;
        }

        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }

        .tutorial-overlay.show {
            display: flex;
            opacity: 1;
        }

        .tutorial-content {
            background: white;
            width: 90%;
            max-width: 360px;
            margin: auto;
            border-radius: 16px;
            padding: 24px;
            transform: translateY(20px);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .tutorial-overlay.show .tutorial-content {
            transform: translateY(0);
        }

        .tutorial-step {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
        }

        .step-number {
            width: 24px;
            height: 24px;
            background: #ff2442;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        /* 修复卡片边距问题 */
        @media (max-width: 430px) {
            .content-box {
                margin: 12px auto;
            }
            
            .input-area {
                min-height: 120px;
            }
        }

        /* 添加示例选择器样式 */
        .example-selector {
            position: absolute;
            top: 50px;
            right: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 12px;
            z-index: 100;
            width: 200px;
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .example-selector.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .example-item {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .example-item:last-child {
            margin-bottom: 0;
        }

        .example-item:hover {
            background: #f5f5f5;
        }

        .example-item-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .example-item-desc {
            font-size: 12px;
            color: #666;
        }

        /* 添加卡片容器样式，使两个卡片居中显示 */
        .cards-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* 比对按钮样式增强 */
        .compare-btn {
            width: 100%;
            background: #ff2442;
            color: white;
            padding: 14px 0;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            margin: 16px 0 24px;
            box-shadow: 0 4px 12px rgba(255, 36, 66, 0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 36, 66, 0.25);
        }

        .compare-btn:active {
            transform: scale(0.98) translateY(0);
            box-shadow: 0 2px 8px rgba(255, 36, 66, 0.2);
        }

        .compare-btn.loading {
            pointer-events: none;
            background: #ff3b59;
        }

        .compare-btn.loading::after {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            left: calc(50% - 30px);
            top: calc(50% - 10px);
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 使用说明按钮样式增强 */
        .tutorial-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 10px;
            border-radius: 16px;
            background: rgba(255, 36, 66, 0.1);
            color: #ff2442;
            transition: all 0.3s ease;
        }

        .tutorial-btn:hover {
            background: rgba(255, 36, 66, 0.15);
            transform: translateY(-1px);
        }

        .tutorial-btn:active {
            transform: translateY(1px);
        }

        .tutorial-btn i {
            transition: transform 0.3s ease;
        }

        .tutorial-btn:hover i {
            transform: rotate(15deg);
        }

        @media (min-width: 768px) {
            .cards-container {
                padding: 0 24px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <div class="sticky top-0 bg-white z-10 px-4 py-3 border-b border-gray-200">
            <div class="flex items-center">
                <a href="home.html" class="mr-4" title="返回首页">
                    <i class="fas fa-arrow-left text-xl text-gray-600"></i>
                </a>
                <h1 class="text-lg font-semibold">背诵比对</h1>
                <button class="ml-auto tutorial-btn" onclick="showTutorial()">
                    <i class="fas fa-question-circle"></i>
                    <span>使用说明</span>
                </button>
            </div>
        </div>

        <!-- 内容区域 -->
        <div class="content-area" id="content">
            <!-- 卡片容器 -->
            <div class="cards-container">
                <!-- 正确版本框 -->
                <div class="content-box">
                    <div class="box-header">
                        <span class="font-semibold">正确版本</span>
                        <span class="text-sm text-gray-500">请输入要背诵的内容</span>
                        <button class="example-btn" onclick="toggleExampleSelector()">
                            <i class="fas fa-lightbulb"></i>
                            <span>加载示例</span>
                        </button>
                        <div class="example-selector" id="exampleSelector">
                            <!-- 示例选项将通过JavaScript动态添加 -->
                        </div>
                    </div>
                    <div class="input-area" id="correctVersion" contenteditable="true" placeholder="在此输入或粘贴文本..."></div>
                    <div class="upload-options">
                        <button class="upload-btn" onclick="uploadPhoto('camera', 'correct')" title="拍照上传">
                            <i class="fas fa-camera"></i>
                            <span>拍照上传</span>
                        </button>
                        <button class="upload-btn" onclick="uploadPhoto('gallery', 'correct')" title="从相册选择">
                            <i class="fas fa-image"></i>
                            <span>从相册选择</span>
                        </button>
                    </div>
                </div>

                <!-- 背诵版本框 -->
                <div class="content-box">
                    <div class="box-header">
                        <span class="font-semibold">背诵版本</span>
                        <span class="text-sm text-gray-500">请提交您的背诵内容</span>
                    </div>
                    <div class="input-area" id="reciteVersion" contenteditable="true" placeholder="在此输入或粘贴文本..."></div>
                    <div class="upload-options">
                        <button class="upload-btn" onclick="uploadPhoto('camera', 'recite')" title="拍照上传">
                            <i class="fas fa-camera"></i>
                            <span>拍照上传</span>
                        </button>
                        <button class="upload-btn" onclick="uploadPhoto('gallery', 'recite')" title="从相册选择">
                            <i class="fas fa-image"></i>
                            <span>从相册选择</span>
                        </button>
                        <button class="voice-record-btn" id="recordBtn" title="语音录制">
                            <i class="fas fa-microphone"></i>
                            <span class="recording-timer" id="recordingTimer">00:00</span>
                        </button>
                    </div>
                </div>

                <!-- 比对按钮 -->
                <button class="compare-btn" id="compareBtn" onclick="startCompare()">
                    开始生成
                </button>
            </div>
        </div>

        <!-- 底部导航栏 -->
        <nav class="bottom-nav">
            <div class="nav-items">
                <a href="home.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>首页</span>
                </a>
                <a href="discover.html" class="nav-item">
                    <i class="fas fa-compass"></i>
                    <span>发现</span>
                </a>
                <a href="recite.html" class="nav-item recite-nav-item active">
                    <div class="recite-icon-wrapper">
                        <i class="fas fa-book-reader"></i>
                    </div>
                    <span>背诵比对</span>
                </a>
                <a href="message.html" class="nav-item">
                    <i class="fas fa-comment-dots"></i>
                    <span>消息</span>
                </a>
                <a href="profile.html" class="nav-item">
                    <i class="fas fa-user"></i>
                    <span>我的</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- 比对结果面板 -->
    <div class="result-panel" id="resultPanel">
        <div class="result-panel-header">
            <div class="result-panel-title">背诵比对结果</div>
            <button class="result-panel-close" onclick="closeResultPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="text-center mb-6">
            <div class="score-circle" id="scoreCircle">92</div>
            <div class="text-xl font-semibold mt-2" id="scoreComment">非常棒！继续保持</div>
        </div>
        
        <div class="analysis-section">
            <h3 class="font-semibold mb-3">评分详情</h3>
        <div class="mb-4">
            <div class="flex justify-between text-sm text-gray-500 mb-2">
                <span>内容完整度</span>
                <span id="completenessScore">95%</span>
            </div>
            <div class="progress-bar">
                    <div class="progress-bar-fill" id="completenessFill" style="--progress-width: 95%"></div>
            </div>
        </div>
        <div class="mb-4">
            <div class="flex justify-between text-sm text-gray-500 mb-2">
                <span>表达准确度</span>
                <span id="accuracyScore">90%</span>
            </div>
            <div class="progress-bar">
                    <div class="progress-bar-fill" id="accuracyFill" style="--progress-width: 90%"></div>
            </div>
        </div>
        <div class="mb-4">
            <div class="flex justify-between text-sm text-gray-500 mb-2">
                <span>逻辑连贯性</span>
                <span id="logicScore">92%</span>
            </div>
            <div class="progress-bar">
                    <div class="progress-bar-fill" id="logicFill" style="--progress-width: 92%"></div>
            </div>
        </div>
        </div>
        
        <div class="analysis-section">
            <h3 class="font-semibold mb-3">详细分析</h3>
            <p class="text-gray-600 text-sm" id="analysisIntro">您的背诵内容基本完整，重点内容把握准确。以下是具体分析：</p>
            <ul class="text-sm text-gray-600 mt-3 space-y-3" id="analysisDetails">
                <li>✓ 完整复述了马克思主义哲学的基本原理</li>
                <li>✓ 准确把握了"实践"与"认识"的辩证关系</li>
                <li>⚠️ "<span class="diff-text">认识规律是从感性认识到理性认识</span>" 应为 "<span class="highlight">认识的规律是由感性认识到理性认识</span>"</li>
                <li>💡 建议加强对以下概念的理解：
                    <ul class="ml-4 mt-1 list-disc">
                        <li>实践与认识的关系</li>
                        <li>真理的绝对性与相对性</li>
                    </ul>
                </li>
            </ul>
        </div>
        
        <div class="analysis-section">
            <h3 class="font-semibold mb-3">记忆曲线分析</h3>
            <p class="text-gray-600 text-sm">根据您的背诵历史，我们分析了您的记忆曲线：</p>
            <div class="h-32 bg-white rounded-lg mt-3 p-2 flex items-end justify-between">
                <div class="h-3/4 w-8 bg-green-100 rounded-t-md relative">
                    <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">首次</span>
                    <span class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">85%</span>
                </div>
                <div class="h-5/6 w-8 bg-green-200 rounded-t-md relative">
                    <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">1天后</span>
                    <span class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">88%</span>
                </div>
                <div class="h-11/12 w-8 bg-green-300 rounded-t-md relative">
                    <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">3天后</span>
                    <span class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">92%</span>
                </div>
                <div class="h-full w-8 bg-green-400 rounded-t-md relative">
                    <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">7天后</span>
                    <span class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">95%</span>
                </div>
                <div class="h-5/6 w-8 bg-gray-200 rounded-t-md relative border-2 border-dashed border-gray-400">
                    <span class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">14天后</span>
                    <span class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500">预测</span>
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-8 text-center">建议在7天后进行下一次复习，以巩固记忆</p>
        </div>
        
        <button class="continue-btn" onclick="closeResultPanel()">
            继续背诵
        </button>
    </div>

    <!-- 使用说明弹窗 -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <h2 class="text-xl font-bold mb-4">如何使用背诵比对</h2>
            <div class="tutorial-step">
                <div class="step-number">1</div>
                <div>
                    <h3 class="font-semibold mb-1">输入正确内容</h3>
                    <p class="text-sm text-gray-600">在上方输入框中输入要背诵的内容，可以直接输入、拍照或从相册选择，也可以点击"加载示例"选择预设内容</p>
                </div>
            </div>
            <div class="tutorial-step">
                <div class="step-number">2</div>
                <div>
                    <h3 class="font-semibold mb-1">提交背诵内容</h3>
                    <p class="text-sm text-gray-600">按住录音按钮开始录制您的背诵内容，松开按钮结束录制；或直接在下方输入框中输入文字</p>
                </div>
            </div>
            <div class="tutorial-step">
                <div class="step-number">3</div>
                <div>
                    <h3 class="font-semibold mb-1">查看分析结果</h3>
                    <p class="text-sm text-gray-600">点击"开始生成"按钮，系统会自动分析您的背诵内容，并给出详细的评分和改进建议</p>
                </div>
            </div>
            <div class="p-4 bg-gray-50 rounded-lg mt-4 mb-4">
                <h3 class="font-semibold mb-2 text-sm">背诵比对功能说明</h3>
                <p class="text-xs text-gray-600">背诵比对功能基于AI大模型技术，不仅比对文字的相似度，更注重对内容理解的准确性。系统会从内容完整度、表达准确度和逻辑连贯性三个维度进行评分，并提供针对性的改进建议。</p>
            </div>
            <button class="w-full bg-red-500 text-white py-3 rounded-full font-semibold mt-4" onclick="closeTutorial()">
                知道了
            </button>
        </div>
    </div>

    <script>
        let isRecording = false;
        let recordingTimer;
        let startTime;
        const recordBtn = document.getElementById('recordBtn');
        const resultPanel = document.getElementById('resultPanel');
        const timerDisplay = document.getElementById('recordingTimer');
        const tutorialOverlay = document.getElementById('tutorialOverlay');
        const correctVersion = document.getElementById('correctVersion');
        const reciteVersion = document.getElementById('reciteVersion');
        const exampleSelector = document.getElementById('exampleSelector');

        // 示例内容
        const exampleContents = {
            philosophy: {
                correct: `马克思主义认识论认为：实践是认识的来源。认识的过程是一个实践、认识、再实践、再认识的循环上升过程。实践是检验真理的根本标准。

真理具有客观性，同时具有绝对性和相对性的统一。认识的规律是由感性认识到理性认识，再由理性认识到实践的飞跃。`,
                recite: `马克思主义认识论认为实践是认识的来源。认识的过程是实践、认识、再实践、再认识的循环上升过程。实践是检验真理的根本标准。

真理具有客观性，具有绝对性和相对性的统一特征。认识规律是由感性认识到理性认识，再从理性认识到实践的飞跃。`,
                analysis: {
                    score: 92,
                    comment: "非常棒！继续保持",
                    completeness: 95,
                    accuracy: 90,
                    logic: 92,
                    intro: "您的背诵内容基本完整，重点内容把握准确。以下是具体分析：",
                    details: [
                        "✓ 完整复述了马克思主义哲学的基本原理",
                        "✓ 准确把握了\"实践\"与\"认识\"的辩证关系",
                        "⚠️ \"<span class=\\\"diff-text\\\">认识规律是从感性认识到理性认识</span>\" 应为 \"<span class=\\\"highlight\\\">认识的规律是由感性认识到理性认识</span>\"",
                        "💡 建议加强对以下概念的理解：<ul class=\\\"ml-4 mt-1 list-disc\\\"><li>实践与认识的关系</li><li>真理的绝对性与相对性</li></ul>"
                    ]
                }
            },
            politics: {
                correct: `商品是用来交换的劳动产品。商品具有使用价值和价值两个因素。使用价值是指商品能够满足人们某种需要的属性，是商品的自然属性。价值是凝结在商品中的无差别的人类劳动，是商品的社会属性。

商品的二因素反映了生产商品的劳动的二重性：具体劳动和抽象劳动。具体劳动创造使用价值，抽象劳动形成价值。`,
                recite: `商品是用来交换的劳动产品，具有使用价值和价值两个基本属性。使用价值是指商品能够满足人们某种需要的属性，是商品的自然属性；价值是凝结在商品中的无差别的人类劳动，是商品的社会属性。

商品的两个基本属性反映了生产商品的劳动的二重性：具体劳动创造使用价值，抽象劳动形成价值。`,
                analysis: {
                    score: 94,
                    comment: "出色的表现！",
                    completeness: 96,
                    accuracy: 94,
                    logic: 93,
                    intro: "您对政治经济学核心概念的理解非常到位，表述清晰准确：",
                    details: [
                        "✓ 准确描述了商品的定义和基本属性",
                        "✓ 正确区分了使用价值和价值的本质区别",
                        "✓ 清晰阐述了具体劳动和抽象劳动的关系",
                        "⚠️ \"<span class=\\\"diff-text\\\">两个基本属性</span>\" 表述不够准确，应为 \"<span class=\\\"highlight\\\">二因素</span>\"",
                        "💡 建议进一步理解：<ul class=\\\"ml-4 mt-1 list-disc\\\"><li>价值形式的发展</li><li>商品拜物教的本质</li></ul>"
                    ]
                }
            },
            history: {
                correct: `新民主主义革命是无产阶级领导的，人民大众的，反对帝国主义、封建主义和官僚资本主义的革命。其基本内容是：没收官僚资本，没收地主阶级的土地归农民所有，保护民族工商业。

新民主主义革命的动力是工人阶级、农民阶级、城市小资产阶级和民族资产阶级。其领导力量是工人阶级及其政党——中国共产党。`,
                recite: `新民主主义革命是无产阶级领导的人民大众的革命，反对帝国主义、封建主义和官僚资本主义。基本内容包括没收官僚资本，没收地主阶级土地归农民所有，保护民族工商业。

革命动力是工人阶级、农民阶级、城市小资产阶级和民族资产阶级，领导力量是工人阶级和中国共产党。`,
                analysis: {
                    score: 90,
                    comment: "很好的理解！",
                    completeness: 92,
                    accuracy: 90,
                    logic: 89,
                    intro: "您对新民主主义革命的理解基本正确，把握了核心要点：",
                    details: [
                        "✓ 正确描述了新民主主义革命的性质和对象",
                        "✓ 准确列举了革命的基本内容",
                        "✓ 基本把握了革命动力和领导力量",
                        "⚠️ 表述略显简略，可以更加完整地阐述各要点之间的关系",
                        "💡 建议进一步学习：<ul class=\\\"ml-4 mt-1 list-disc\\\"><li>新民主主义革命的历史背景</li><li>新民主主义与社会主义革命的关系</li></ul>"
                    ]
                }
            },
            english: {
                correct: `Academic writing is characterized by several features: formality, precision, objectivity, explicitness, hedging, and responsibility. It uses formal language, avoids colloquialisms, and employs precise vocabulary. 

Academic texts aim to be objective, presenting evidence rather than personal opinions. They are explicit about connections between ideas, often use hedging language to qualify claims, and take responsibility for the accuracy of information presented.`,
                recite: `Academic writing has several key features including formality, precision, objectivity, explicitness, hedging and responsibility. It uses formal language and precise vocabulary while avoiding casual expressions.

Academic texts try to be objective by presenting evidence instead of personal views. They make connections between ideas clear, use cautious language when making claims, and take responsibility for information accuracy.`,
                analysis: {
                    score: 95,
                    comment: "优秀的背诵！",
                    completeness: 97,
                    accuracy: 95,
                    logic: 94,
                    intro: "您对学术写作特点的背诵非常准确，把握了所有关键点：",
                    details: [
                        "✓ 完整列举了学术写作的六大特点",
                        "✓ 准确描述了各个特点的具体表现",
                        "✓ 语言表达流畅，逻辑清晰",
                        "⚠️ 个别表述略有简化，但不影响整体理解",
                        "💡 建议进一步学习：<ul class=\\\"ml-4 mt-1 list-disc\\\"><li>学术写作中的引用规范</li><li>不同学科的学术写作风格差异</li></ul>"
                    ]
                }
            },
            math: {
                correct: `极限的ε-δ定义：设函数f(x)在点x₀的某一去心邻域内有定义，L是一个常数。如果对于任意给定的正数ε，都存在正数δ，使得当0<|x-x₀|<δ时，有|f(x)-L|<ε成立，则称L为函数f(x)当x→x₀时的极限，记作lim(x→x₀)f(x)=L。

函数连续性定义：如果函数f(x)在点x₀处的极限存在且等于函数值f(x₀)，即lim(x→x₀)f(x)=f(x₀)，则称函数f(x)在点x₀处连续。`,
                recite: `极限的ε-δ定义是：设函数f(x)在x₀的某去心邻域有定义，L为常数。对任意正数ε，存在正数δ，使得当0<|x-x₀|<δ时，|f(x)-L|<ε成立，则L为函数f(x)当x→x₀时的极限，记为lim(x→x₀)f(x)=L。

函数连续性定义：函数f(x)在点x₀处的极限存在且等于函数值f(x₀)，即lim(x→x₀)f(x)=f(x₀)，则函数f(x)在点x₀处连续。`,
                analysis: {
                    score: 98,
                    comment: "几乎完美！",
                    completeness: 99,
                    accuracy: 98,
                    logic: 97,
                    intro: "您对极限和连续性定义的背诵非常精确：",
                    details: [
                        "✓ 极限的ε-δ定义表述准确完整",
                        "✓ 函数连续性定义表述简洁明了",
                        "✓ 数学符号使用正确",
                        "⚠️ 极限定义中略去了\"设\"和\"如果\"等少量连接词，但不影响数学含义",
                        "💡 建议进一步学习：<ul class=\\\"ml-4 mt-1 list-disc\\\"><li>函数在区间上的连续性</li><li>连续函数的性质</li></ul>"
                    ]
                }
            }
        };

        // 录音按钮点击事件
        recordBtn.addEventListener('touchstart', startRecording);
        recordBtn.addEventListener('touchend', stopRecording);
        recordBtn.addEventListener('mousedown', startRecording);
        recordBtn.addEventListener('mouseup', stopRecording);

        // 开始录音
        function startRecording(e) {
            e.preventDefault();
            isRecording = true;
            recordBtn.classList.add('recording');
            timerDisplay.classList.add('show');
            startTime = Date.now();
            
            // 添加震动反馈（如果设备支持）
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
            
            // 更新计时器显示
            recordingTimer = setInterval(updateTimer, 1000);
            
            // 这里应该调用实际的录音API
            console.log('开始录音...');
        }

        // 停止录音
        function stopRecording(e) {
            if (!isRecording) return;
            
            e.preventDefault();
            isRecording = false;
            recordBtn.classList.remove('recording');
            clearInterval(recordingTimer);
            
            // 添加震动反馈（如果设备支持）
            if (navigator.vibrate) {
                navigator.vibrate([50, 50, 50]);
            }
            
            // 这里应该停止录音并处理录音结果
            console.log('停止录音，录音时长：' + timerDisplay.textContent);
            
            // 模拟语音识别过程
            setTimeout(() => {
                timerDisplay.classList.remove('show');
                // 模拟将识别结果填入背诵版本框
                reciteVersion.textContent = '正在识别语音...';
                
                setTimeout(() => {
                    // 根据当前加载的示例类型填入对应的背诵内容
                    const currentExample = document.querySelector('.example-item-title')?.textContent;
                    if (currentExample === '马克思主义哲学') {
                        reciteVersion.textContent = exampleContents.philosophy.recite;
                    } else if (currentExample === '政治经济学') {
                        reciteVersion.textContent = exampleContents.politics.recite;
                    } else if (currentExample === '中国近代史') {
                        reciteVersion.textContent = exampleContents.history.recite;
                    } else if (currentExample === '考研英语') {
                        reciteVersion.textContent = exampleContents.english.recite;
                    } else if (currentExample === '高等数学') {
                        reciteVersion.textContent = exampleContents.math.recite;
                    } else {
                        reciteVersion.textContent = '语音识别完成。请检查识别结果是否准确。';
                    }
                    
                    // 添加识别完成的视觉反馈
                    reciteVersion.classList.add('highlight');
                    setTimeout(() => {
                        reciteVersion.classList.remove('highlight');
                    }, 1000);
                }, 1500);
            }, 1000);
        }

        // 更新录音计时器
        function updateTimer() {
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsedTime / 60).toString().padStart(2, '0');
            const seconds = (elapsedTime % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;
        }

        // 开始比对
        function startCompare() {
            const compareBtn = document.getElementById('compareBtn');
            const correct = correctVersion.textContent.trim();
            const recite = reciteVersion.textContent.trim();
            
            if (!correct || !recite) {
                alert('请确保正确版本和背诵版本都已填写');
                return;
            }
            
            // 显示加载状态
            compareBtn.innerHTML = '<span style="margin-right: 30px;">生成中...</span>';
            compareBtn.classList.add('loading');
            compareBtn.disabled = true;
            
            // 添加震动反馈（如果设备支持）
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
            
            // 模拟比对过程
            setTimeout(() => {
                // 根据当前内容确定要显示的分析结果
                let analysisResult;
                if (correct.includes('马克思主义认识论')) {
                    analysisResult = exampleContents.philosophy.analysis;
                } else if (correct.includes('商品是用来交换的劳动产品')) {
                    analysisResult = exampleContents.politics.analysis;
                } else if (correct.includes('新民主主义革命')) {
                    analysisResult = exampleContents.history.analysis;
                } else if (correct.includes('Academic writing')) {
                    analysisResult = exampleContents.english.analysis;
                } else if (correct.includes('极限的ε-δ定义')) {
                    analysisResult = exampleContents.math.analysis;
                } else {
                    // 默认分析结果
                    analysisResult = {
                        score: 85,
                        comment: "不错的尝试！",
                        completeness: 85,
                        accuracy: 82,
                        logic: 88,
                        intro: "您的背诵内容基本符合要求，但还有提升空间：",
                        details: [
                            "✓ 主要内容要点基本覆盖",
                            "⚠️ 部分表述不够准确，请对照原文检查",
                            "💡 建议进一步加强记忆，提高表达的准确性和完整性"
                        ]
                    };
                }
                
                // 更新结果面板内容
                document.getElementById('scoreCircle').textContent = analysisResult.score;
                document.getElementById('scoreComment').textContent = analysisResult.comment;
                document.getElementById('completenessScore').textContent = analysisResult.completeness + '%';
                document.getElementById('completenessFill').style.setProperty('--progress-width', analysisResult.completeness + '%');
                document.getElementById('accuracyScore').textContent = analysisResult.accuracy + '%';
                document.getElementById('accuracyFill').style.setProperty('--progress-width', analysisResult.accuracy + '%');
                document.getElementById('logicScore').textContent = analysisResult.logic + '%';
                document.getElementById('logicFill').style.setProperty('--progress-width', analysisResult.logic + '%');
                document.getElementById('analysisIntro').textContent = analysisResult.intro;
                
                // 更新分析详情
                const detailsList = document.getElementById('analysisDetails');
                detailsList.innerHTML = '';
                analysisResult.details.forEach(detail => {
                    const li = document.createElement('li');
                    li.innerHTML = detail;
                    detailsList.appendChild(li);
                });
                
                // 显示结果面板，添加全屏动画效果
                resultPanel.style.display = 'block';
                
                // 添加震动反馈（如果设备支持）
                if (navigator.vibrate) {
                    navigator.vibrate([50, 100, 50]);
                }
                
                // 使用动画效果显示结果面板
                setTimeout(() => {
                    resultPanel.classList.add('show');
                    
                    // 恢复按钮状态
                    compareBtn.textContent = '开始生成';
                    compareBtn.classList.remove('loading');
                    compareBtn.disabled = false;
                    
                    // 延迟添加进度条动画类
                    setTimeout(() => {
                        document.querySelectorAll('.progress-bar-fill').forEach(fill => {
                            fill.classList.add('animate');
                        });
                    }, 300);
                }, 200);
            }, 2000);
        }

        // 关闭结果面板
        function closeResultPanel() {
            resultPanel.classList.remove('show');
            
            // 移除进度条动画类
            document.querySelectorAll('.progress-bar-fill').forEach(fill => {
                fill.classList.remove('animate');
            });
            
            // 延迟隐藏面板
            setTimeout(() => {
                resultPanel.style.display = 'none';
            }, 500);
        }

        // 显示使用说明
        function showTutorial() {
            tutorialOverlay.classList.add('show');
        }

        // 关闭使用说明
        function closeTutorial() {
            tutorialOverlay.classList.remove('show');
        }

        // 切换示例选择器
        function toggleExampleSelector() {
            exampleSelector.classList.toggle('show');
        }

        // 加载示例内容
        function loadExample(type) {
            correctVersion.textContent = exampleContents[type].correct;
            reciteVersion.textContent = '';
            exampleSelector.classList.remove('show');
        }

        // 上传照片（模拟）
        function uploadPhoto(source, target) {
            const targetElement = target === 'correct' ? correctVersion : reciteVersion;
            
            // 模拟上传和识别过程
            targetElement.textContent = '正在处理图片...';
            
            setTimeout(() => {
                if (target === 'correct') {
                    // 随机选择一个示例内容
                    const examples = ['philosophy', 'politics', 'history', 'english', 'math'];
                    const randomExample = examples[Math.floor(Math.random() * examples.length)];
                    targetElement.textContent = exampleContents[randomExample].correct;
                } else {
                    // 如果正确版本已有内容，尝试匹配对应的背诵版本
                    const correct = correctVersion.textContent;
                    if (correct.includes('马克思主义认识论')) {
                        targetElement.textContent = exampleContents.philosophy.recite;
                    } else if (correct.includes('商品是用来交换的劳动产品')) {
                        targetElement.textContent = exampleContents.politics.recite;
                    } else if (correct.includes('新民主主义革命')) {
                        targetElement.textContent = exampleContents.history.recite;
                    } else if (correct.includes('Academic writing')) {
                        targetElement.textContent = exampleContents.english.recite;
                    } else if (correct.includes('极限的ε-δ定义')) {
                        targetElement.textContent = exampleContents.math.recite;
                    } else {
                        targetElement.textContent = '图片识别完成。请检查识别结果是否准确。';
                    }
                }
            }, 1500);
        }

        // 检查是否是首次访问，如果是则显示教程
        if (!localStorage.getItem('tutorialShown')) {
            setTimeout(() => {
                showTutorial();
                localStorage.setItem('tutorialShown', 'true');
            }, 1000);
        }

        // 页面加载时更新示例选择器
        document.addEventListener('DOMContentLoaded', function() {
            updateExampleSelector();
        });

        // 在示例选择器中添加新的示例选项
        function updateExampleSelector() {
            const exampleSelector = document.getElementById('exampleSelector');
            exampleSelector.innerHTML = `
                    <div class="example-item" onclick="loadExample('philosophy')">
                        <div class="example-item-title">马克思主义哲学</div>
                        <div class="example-item-desc">认识论基本原理</div>
                    </div>
                    <div class="example-item" onclick="loadExample('politics')">
                        <div class="example-item-title">政治经济学</div>
                        <div class="example-item-desc">商品的二因素</div>
                    </div>
                    <div class="example-item" onclick="loadExample('history')">
                        <div class="example-item-title">中国近代史</div>
                        <div class="example-item-desc">新民主主义革命</div>
                    </div>
                <div class="example-item" onclick="loadExample('english')">
                    <div class="example-item-title">考研英语</div>
                    <div class="example-item-desc">学术写作特点</div>
                </div>
                <div class="example-item" onclick="loadExample('math')">
                    <div class="example-item-title">高等数学</div>
                    <div class="example-item-desc">极限与连续性</div>
            </div>
            `;
        }
    </script>
</body>
</html>